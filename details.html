<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trip Details - Madara Travels</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="style.css" />

    <style>
      /* (Keep all your existing styles here) */
      :root { --primary-dark: #022c22; --accent-gold: #c2410c; --bg-lux: #fdfbf7; }
      body { background-color: var(--bg-lux); color: #333; }
      .hero-wrapper { height: 85vh; position: relative; overflow: hidden; background: #000; }
      .hero-backup-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; opacity: 0; transition: opacity 0.5s ease; }
      .hero-backup-img.visible { opacity: 1; }
      .hero-video { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 1; opacity: 0; transition: opacity 1s ease; }
      .hero-video.loaded { opacity: 1; }
      .hero-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.8)); z-index: 2; }
      .nav-back { position: absolute; top: 40px; left: 40px; color: white; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.1); padding: 10px 25px; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: 0.3s; z-index: 10; }
      .sound-btn { position: absolute; bottom: 40px; right: 40px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; backdrop-filter: blur(5px); transition: 0.3s; }
      .hero-content { position: absolute; bottom: 80px; left: 5%; max-width: 900px; color: white; z-index: 3; animation: slideUp 1s ease-out; }
      .trip-tag { background: var(--accent-gold); color: white; padding: 6px 15px; text-transform: uppercase; font-size: 0.8rem; font-weight: 700; border-radius: 4px; letter-spacing: 2px; display: inline-block; margin-bottom: 20px; }
      .hero-title { font-family: "Playfair Display", serif; font-size: 5rem; line-height: 1; margin: 0 0 20px 0; text-shadow: 0 10px 30px rgba(0,0,0,0.5); }
      .hero-meta { display: flex; gap: 30px; font-family: "Poppins", sans-serif; font-size: 1.1rem; }
      .content-wrapper { max-width: 1300px; margin: 0 auto; padding: 80px 5%; display: grid; grid-template-columns: 1.5fr 1fr; gap: 80px; }
      .section-title { font-family: "Playfair Display", serif; font-size: 2.5rem; margin-bottom: 30px; color: var(--primary-dark); position: relative; }
      .section-title::after { content: ""; display: block; width: 60px; height: 3px; background: var(--accent-gold); margin-top: 15px; }
      .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 60px; }
      .gallery-item { height: 180px; border-radius: 12px; overflow: hidden; position: relative; background: #e0e0e0; }
      .gallery-img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 0.5s; position: relative; z-index: 2; }
      .gallery-img.loaded { opacity: 1; }
      .itinerary-list { border-left: 2px solid #e5e7eb; margin-left: 10px; padding-left: 40px; }
      .day-card { position: relative; margin-bottom: 40px; }
      .day-card::before { content: ""; position: absolute; left: -47px; top: 5px; width: 16px; height: 16px; background: var(--primary-dark); border-radius: 50%; border: 4px solid white; box-shadow: 0 0 0 1px #e5e7eb; }
      .day-header { font-size: 1.2rem; font-weight: 700; color: var(--primary-dark); margin-bottom: 10px; }
      .day-body { color: #666; line-height: 1.6; }
      .booking-card { position: sticky; top: 40px; background: white; padding: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.08); border: 1px solid rgba(0,0,0,0.05); text-align: center; }
      .price-tag { font-size: 3rem; font-weight: 700; color: var(--primary-dark); font-family: "Playfair Display", serif; }
      /* ===================================================
   FIX: BOOKING CARD LIST (Premium Style)
   =================================================== */
.features-list {
  list-style: none !important; /* Removes the ugly discs/bullets */
  padding: 20px 0 !important;  /* Adds space inside the lines */
  margin: 20px 0;              /* Adds space outside */
  text-align: left;            /* Aligns text to the left */
  
  /* The "Premium" Look: Thin separators */
  border-top: 1px solid rgba(0,0,0,0.1);
  border-bottom: 1px solid rgba(0,0,0,0.1);
}

.features-list li {
  display: flex;
  align-items: center; /* Centers icon with text */
  gap: 12px;           /* Space between icon and text */
  margin-bottom: 12px;
  color: #4b5563;      /* Soft grey text */
  font-size: 0.95rem;
  font-weight: 500;
}

.features-list li:last-child {
  margin-bottom: 0;    /* Removes space from last item */
}

.features-list i {
  color: var(--accent-gold); /* Uses your theme color */
  font-size: 1.1rem;
  min-width: 24px;     /* Keeps alignment perfect */
  text-align: center;
}
      .book-btn { background: var(--primary-dark); color: white; width: 100%; padding: 18px; font-weight: 600; border: none; cursor: pointer; transition: 0.3s; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; }
      #map-container { height: 400px; width: 100%; border-radius: 20px; overflow: hidden; margin-bottom: 60px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); position: relative; z-index: 1; }
      #map { height: 100%; width: 100%; }
      @media (max-width: 1000px) { .content-wrapper { grid-template-columns: 1fr; } .booking-card { position: static; margin-top: 40px; } }
      @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
  </head>
  <body>

    <div class="hero-wrapper">
      <img id="heroBackup" class="hero-backup-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Background">
      <video id="heroVideo" class="hero-video" muted loop playsinline></video>
      <div class="hero-overlay"></div>
      <button id="soundBtn" class="sound-btn">üîá</button>
      <a href="home.html" class="nav-back">‚Üê Back</a>
      
      <div class="hero-content">
        <div class="trip-tag" id="tripCategory">EXPERIENCE</div>
        <h1 class="hero-title" id="tripTitle">Loading...</h1>
        <div class="hero-meta">
          <div class="meta-item"><i class="fa-solid fa-location-dot"></i> <span id="tripLoc">Location</span></div>
          <div class="meta-item"><i class="fa-regular fa-clock"></i> <span id="tripDuration">4 Days</span></div>
          <div class="meta-item"><i class="fa-solid fa-user-group"></i> <span id="tripGroup">Max 12</span></div>
        </div>
      </div>
    </div>

    <div class="content-wrapper">
      <div class="details-column">
        <h2 class="section-title">The Experience</h2>
        <p class="trip-description" id="tripDesc">Loading details...</p>
        
        <div class="gallery-grid" id="photoGallery"></div>

        <h2 class="section-title">Explore Location</h2>
        <div id="map-container">
          <div id="map"></div>
        </div>

        <h2 class="section-title">Your Itinerary</h2>
        <div class="itinerary-list" id="itineraryBox"></div>
      </div>

      <div class="sidebar">
        <div class="booking-card">
          <div class="price-tag" id="priceTag">$0</div>
          <span style="color:#999; display:block; margin-bottom:30px;">per person</span>
          <ul class="features-list">
            <li><i class="fa-solid fa-check"></i> Premium Accommodation</li>
            <li><i class="fa-solid fa-check"></i> Expert Local Guide</li>
            <li><i class="fa-solid fa-check"></i> All Meals Included</li>
            <li><i class="fa-solid fa-check"></i> Transportation</li>
          </ul>
          <button class="book-btn" id="bookNowBtn">Reserve Now</button>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>

    <script>
      // --- 1. RICH ITINERARY & CONTENT ---
      const tripContent = {
        beach: {
          video: "./assets/image/video/default.mp4", 
          image: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=90&w=2000",
          gallery: [
            "https://images.unsplash.com/photo-1519046904884-53103b34b206?q=90&w=1200",
            "https://images.unsplash.com/photo-1473116763249-564319124210?q=90&w=1200",
            "https://images.unsplash.com/photo-1506953823976-52e1fdc0149a?q=90&w=1200"
          ],
          days: [
            { title: "Arrival in Paradise", desc: "Check into your oceanfront villa. Enjoy a welcome coconut drink." },
            { title: "Island Hopping", desc: "Private boat tour to 3 hidden lagoons and snorkeling with turtles." },
            { title: "Deep Blue Dive", desc: "Scuba diving session for beginners or pros to explore coral reefs." },
            { title: "Sun & Spa", desc: "A relaxed morning with a complimentary massage before departure." }
          ]
        },
        mountain: {
          video: "./assets/image/video/mountain.mp4",
          image: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=90&w=2000",
          gallery: [
            "https://images.unsplash.com/photo-1486870591958-9b9d0d1dda99?q=90&w=1200",
            "https://images.unsplash.com/photo-1465056836041-7f43ac27dcb5?q=90&w=1200",
            "https://images.unsplash.com/photo-1483729558449-99ef09a8c325?q=90&w=1200"
          ],
          days: [
            { title: "Base Camp Setup", desc: "Meet your expert Sherpa guides. Gear check and acclimatization hike." },
            { title: "The Forest Ascent", desc: "Trek through ancient pine forests and cross suspension bridges." },
            { title: "Summit Push", desc: "An early 4 AM start to catch the sunrise from the peak." },
            { title: "Victory Descent", desc: "Hike back down to the village for a celebratory feast." }
          ]
        },
        city: {
          video: "./assets/image/video/city.mp4",
          image: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=90&w=2000",
          gallery: ["https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?q=90&w=1200", "https://images.unsplash.com/photo-1444723121867-c61e74e36b1a?q=90&w=1200", "https://images.unsplash.com/photo-1449824913929-2bfcb69750e6?q=90&w=1200"],
          days: [
            { title: "Urban Lights", desc: "Evening street food tour and visit the famous night market." },
            { title: "Heritage Walk", desc: "Guided walking tour of the Old Town visiting ancient temples." },
            { title: "Modern Marvels", desc: "Visit the observation deck of the tallest skyscraper." },
            { title: "Culture & Coffee", desc: "Morning visit to art museums and famous local cafes." }
          ]
        },
        desert: {
          video: "./assets/image/video/desert.mp4",
          image: "https://images.unsplash.com/photo-1509316975850-ff9c5deb0cd9?q=90&w=2000",
          gallery: ["https://images.unsplash.com/photo-1473580044384-7ba9967e16a0?q=90&w=1200", "https://images.unsplash.com/photo-1682687220742-aba13b6e50ba?q=90&w=1200", "https://images.unsplash.com/photo-1546272983-603643927959?q=90&w=1200"],
          days: [
            { title: "Into the Dunes", desc: "4x4 Land Cruiser pickup and dune bashing session." },
            { title: "Nomadic Night", desc: "Camel ride into the sunset. Stay in a luxury Bedouin tent." },
            { title: "Sunrise Safari", desc: "Hot air balloon ride over the endless golden sands." },
            { title: "Oasis Lunch", desc: "Relax by a desert oasis pool before heading back." }
          ]
        },
        middle_east: {
          video: "./assets/image/video/desert.mp4", 
          image: "https://images.unsplash.com/photo-1512453979798-5ea90b7cadc9?q=90&w=2000",
          gallery: ["https://images.unsplash.com/photo-1549944850-84e00be4203b?q=90&w=1200", "https://images.unsplash.com/photo-1518684079-3c830dcefacf?q=90&w=1200", "https://images.unsplash.com/photo-1526495124232-a04e1849168c?q=90&w=1200"],
          days: [
            { title: "Skyscraper Tour", desc: "Visit the world's tallest building and enjoy high tea with a view." },
            { title: "Gold & Spices", desc: "Explore the traditional Souks for gold and perfumes." },
            { title: "Luxury Desert", desc: "Private desert dinner with falconry show and stargazing." },
            { title: "Yacht Cruise", desc: "Sunset yacht cruise around the Marina with a buffet dinner." }
          ]
        },
        river: {
          video: "./assets/image/video/adventure.mp4",
          image: "https://images.unsplash.com/photo-1437482078695-73f5ca6c96e2?q=90&w=2000",
          gallery: ["https://images.unsplash.com/photo-1505765050516-f72dcac9c60e?q=90&w=1200", "https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?q=90&w=1200", "https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=90&w=1200"],
          days: [
            { title: "River Cruise", desc: "Board your private houseboat. Cruise through the backwaters." },
            { title: "Jungle Trek", desc: "Guided trek to spot exotic birds and monkeys." },
            { title: "Waterfall Swim", desc: "Discover a hidden waterfall deep in the forest." },
            { title: "Campfire", desc: "Night camping by the riverside with storytelling." }
          ]
        },
        cave: {
          video: "./assets/image/video/adventure.mp4",
          image: "https://images.unsplash.com/photo-1516939884455-1445c8652f83?q=90&w=2000",
          gallery: ["https://images.unsplash.com/photo-1504280506541-aca063246783?q=90&w=1200", "https://images.unsplash.com/photo-1499244571915-71085c9d3c01?q=90&w=1200", "https://images.unsplash.com/photo-1505535162959-9bbcb4fe0a80?q=90&w=1200"],
          days: [
            { title: "Cave Entry", desc: "Gear up with helmets and lights. Descend into the massive chamber." },
            { title: "Underground River", desc: "Kayak through the subterranean river network." },
            { title: "The Great Hall", desc: "See stalactites and stalagmites formed over millions of years." },
            { title: "Surface Hike", desc: "Climb out through the jungle exit." }
          ]
        },
        default: {
          video: "./assets/image/video/default.mp4",
          image: "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?q=90&w=2000",
          gallery: ["https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?q=90&w=1200", "https://images.unsplash.com/photo-1503220317375-aaad61436b1b?q=90&w=1200", "https://images.unsplash.com/photo-1527631746610-bca00a040d60?q=90&w=1200"],
          days: [
            { title: "Welcome", desc: "Arrive and settle into your premium accommodation." },
            { title: "Explore", desc: "Guided tour of the local highlights and hidden gems." },
            { title: "Adventure", desc: "An exciting day of activities tailored to your group." },
            { title: "Departure", desc: "Souvenir shopping and safe travels back home." }
          ]
        }
      };

      const params = new URLSearchParams(window.location.search);
      const serviceId = params.get('id');
      const heroVideo = document.getElementById('heroVideo');
      const heroBackup = document.getElementById('heroBackup');
      const soundBtn = document.getElementById('soundBtn');

      // Sound Toggle
      soundBtn.addEventListener('click', () => {
        if (heroVideo.muted) { heroVideo.muted = false; soundBtn.textContent = "üîä"; } 
        else { heroVideo.muted = true; soundBtn.textContent = "üîá"; }
      });

      // Map Function
      async function initMap(locationName) {
        if (!locationName || typeof L === 'undefined') return;
        const map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
        try {
          const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${locationName}`);
          const data = await res.json();
          if (data && data.length > 0) {
            const lat = data[0].lat; const lon = data[0].lon;
            map.flyTo([lat, lon], 10, { duration: 2.5 });
            L.marker([lat, lon]).addTo(map).bindPopup(`<b>${locationName}</b><br>Your Adventure Starts Here!`).openPopup();
          }
        } catch (err) { console.error("Map Error:", err); }
      }

      document.addEventListener("DOMContentLoaded", async () => {
        if (!serviceId) { window.location.href = "home.html"; return; }

        const { data: service, error } = await supabase
          .from('service')
          .select('*')
          .eq('id', serviceId)
          .single();

        if (service) {
          // 1. Determine Theme
          const keyword = (service.category || service.title).toLowerCase();
          let theme = 'default';
          if (keyword.includes('beach')) theme = 'beach';
          else if (keyword.includes('mountain') || keyword.includes('hill')) theme = 'mountain';
          else if (keyword.includes('city') || keyword.includes('urban')) theme = 'city';
          else if (keyword.includes('desert')) theme = 'desert';
          else if (keyword.includes('middle east') || keyword.includes('dubai')) theme = 'middle_east';
          else if (keyword.includes('river') || keyword.includes('jungle')) theme = 'river';
          else if (keyword.includes('cave')) theme = 'cave';

          // Select Content
          const content = tripContent[theme] || tripContent.default;

          // 2. Load Media Safely
          let dbImage = service.image_url || "";
          if (dbImage.includes("source.unsplash.com")) {
             dbImage = content.image; // Fallback to Theme Image
          }
          heroBackup.src = dbImage;
          heroBackup.onload = () => heroBackup.classList.add('visible');

          if (content.video) {
             heroVideo.src = content.video;
             heroVideo.onloadeddata = () => {
                heroVideo.classList.add('loaded'); 
                heroVideo.play().catch(() => console.log("Autoplay blocked"));
             };
             heroVideo.onerror = () => console.warn("Local video not found");
          }

          // 3. Fill Text
          document.getElementById('tripTitle').textContent = service.title;
          document.getElementById('tripDesc').textContent = service.description + " Immerse yourself in a journey like no other.";
          document.getElementById('tripLoc').textContent = service.location || "Global";
          document.getElementById('priceTag').textContent = service.price || "$99";
          document.getElementById('tripCategory').textContent = service.category || "EXPERIENCE";
          document.getElementById('tripDuration').textContent = service.duration || "5 Days";
          document.getElementById('tripGroup').textContent = service.max_people || "Max 12";

          // 4. Build Gallery
          const backupImage = "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?q=80&w=800"; 
          const galleryHTML = content.gallery.map(imgUrl => `
            <div class="gallery-item">
              <img class="gallery-img" src="${imgUrl}" alt="Gallery" onload="this.classList.add('loaded');" onerror="this.src='${backupImage}';">
            </div>
          `).join('');
          document.getElementById('photoGallery').innerHTML = galleryHTML;

          // 5. Build Itinerary (Correctly uses the specific trip content)
          const itineraryHTML = content.days.map((day, i) => `
            <div class="day-card">
              <div class="day-header">Day ${i+1}: ${day.title}</div>
              <div class="day-body">${day.desc}</div>
            </div>
          `).join('');
          document.getElementById('itineraryBox').innerHTML = itineraryHTML;

          document.getElementById('bookNowBtn').onclick = () => {
             window.location.href = `payment.html?id=${serviceId}`;
          };
          
          if (window.L) initMap(service.location);
        }
      });
    </script>
  </body>
</html>